<!DOCTYPE html><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="Content-Language" content="en"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>bignumtester.js</title><link href="../../../../../../dossier.css" rel="stylesheet" type="text/css"><header><div><form><div><input type="search" placeholder="Search"></div></form></div></header><main><article class="srcfile"><h1>src/javascript/crypto/e2e/math/bignumtester.js</h1><div><table><tr><td><a id="l1"></a><a href="#l1">1</a><td>/**<tr><td><a id="l2"></a><a href="#l2">2</a><td> * @license<tr><td><a id="l3"></a><a href="#l3">3</a><td> * Copyright 2011 Google Inc. All rights reserved.<tr><td><a id="l4"></a><a href="#l4">4</a><td> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);<tr><td><a id="l5"></a><a href="#l5">5</a><td> * you may not use this file except in compliance with the License.<tr><td><a id="l6"></a><a href="#l6">6</a><td> * You may obtain a copy of the License at<tr><td><a id="l7"></a><a href="#l7">7</a><td> *<tr><td><a id="l8"></a><a href="#l8">8</a><td> *   http://www.apache.org/licenses/LICENSE-2.0<tr><td><a id="l9"></a><a href="#l9">9</a><td> *<tr><td><a id="l10"></a><a href="#l10">10</a><td> * Unless required by applicable law or agreed to in writing, software<tr><td><a id="l11"></a><a href="#l11">11</a><td> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,<tr><td><a id="l12"></a><a href="#l12">12</a><td> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<tr><td><a id="l13"></a><a href="#l13">13</a><td> * See the License for the specific language governing permissions and<tr><td><a id="l14"></a><a href="#l14">14</a><td> * limitations under the License.<tr><td><a id="l15"></a><a href="#l15">15</a><td> */<tr><td><a id="l16"></a><a href="#l16">16</a><td><tr><td><a id="l17"></a><a href="#l17">17</a><td>/**<tr><td><a id="l18"></a><a href="#l18">18</a><td> * @fileoverview Performance testing for BigNum and BigNumModulus.<tr><td><a id="l19"></a><a href="#l19">19</a><td> *<tr><td><a id="l20"></a><a href="#l20">20</a><td> * @author fy@google.com (Frank Yellin)<tr><td><a id="l21"></a><a href="#l21">21</a><td> * @author koto@google.com (Krzysztof Kotowicz)<tr><td><a id="l22"></a><a href="#l22">22</a><td> */<tr><td><a id="l23"></a><a href="#l23">23</a><td><tr><td><a id="l24"></a><a href="#l24">24</a><td>goog.provide(&#39;e2e.BigNumTester&#39;);<tr><td><a id="l25"></a><a href="#l25">25</a><td><tr><td><a id="l26"></a><a href="#l26">26</a><td>goog.require(&#39;e2e.BigNum&#39;);<tr><td><a id="l27"></a><a href="#l27">27</a><td>goog.require(&#39;e2e.BigNumModulus&#39;);<tr><td><a id="l28"></a><a href="#l28">28</a><td>goog.require(&#39;e2e.bigNumTestData&#39;);<tr><td><a id="l29"></a><a href="#l29">29</a><td>goog.require(&#39;e2e.ecc.DomainParam&#39;);<tr><td><a id="l30"></a><a href="#l30">30</a><td>goog.require(&#39;e2e.ecc.PrimeCurve&#39;);<tr><td><a id="l31"></a><a href="#l31">31</a><td>goog.require(&#39;e2e.testing.Util&#39;);<tr><td><a id="l32"></a><a href="#l32">32</a><td>goog.setTestOnly();<tr><td><a id="l33"></a><a href="#l33">33</a><td><tr><td><a id="l34"></a><a href="#l34">34</a><td><tr><td><a id="l35"></a><a href="#l35">35</a><td>/**<tr><td><a id="l36"></a><a href="#l36">36</a><td> * Runs performance tests for BigNum operations (P256).<tr><td><a id="l37"></a><a href="#l37">37</a><td> * @return {!Object.&lt;string,Object&gt;} Performance stats (object is filled only<tr><td><a id="l38"></a><a href="#l38">38</a><td> *     when tests are run outside browser).<tr><td><a id="l39"></a><a href="#l39">39</a><td> */<tr><td><a id="l40"></a><a href="#l40">40</a><td>e2e.BigNumTester.runP256Benchmark = function() {<tr><td><a id="l41"></a><a href="#l41">41</a><td>  var P256 = new e2e.BigNum(e2e.bigNumTestData.P_256);<tr><td><a id="l42"></a><a href="#l42">42</a><td>  var A = new e2e.BigNum(e2e.bigNumTestData.A);<tr><td><a id="l43"></a><a href="#l43">43</a><td>  var B = new e2e.BigNum(e2e.bigNumTestData.B);<tr><td><a id="l44"></a><a href="#l44">44</a><td><tr><td><a id="l45"></a><a href="#l45">45</a><td>  var P512 = P256.multiply(P256);<tr><td><a id="l46"></a><a href="#l46">46</a><td>  var params = e2e.ecc.DomainParam.fromCurve(<tr><td><a id="l47"></a><a href="#l47">47</a><td>      e2e.ecc.PrimeCurve.P_256);<tr><td><a id="l48"></a><a href="#l48">48</a><td><tr><td><a id="l49"></a><a href="#l49">49</a><td>  var TIMES = 10000;<tr><td><a id="l50"></a><a href="#l50">50</a><td>  var tests = [];<tr><td><a id="l51"></a><a href="#l51">51</a><td>  e2e.testing.Util.addBenchmark(tests,<tr><td><a id="l52"></a><a href="#l52">52</a><td>      function() {<tr><td><a id="l53"></a><a href="#l53">53</a><td>        for (var i = 0; i &lt; TIMES; ++i)<tr><td><a id="l54"></a><a href="#l54">54</a><td>          params.n.residue(P512);<tr><td><a id="l55"></a><a href="#l55">55</a><td>      },<tr><td><a id="l56"></a><a href="#l56">56</a><td>      &#39;FastModulusFFFFFF.residue&#39;);<tr><td><a id="l57"></a><a href="#l57">57</a><td>  e2e.testing.Util.addBenchmark(tests,<tr><td><a id="l58"></a><a href="#l58">58</a><td>      function() {<tr><td><a id="l59"></a><a href="#l59">59</a><td>        for (var i = 0; i &lt; TIMES; ++i)<tr><td><a id="l60"></a><a href="#l60">60</a><td>          P512.mod(params.n);<tr><td><a id="l61"></a><a href="#l61">61</a><td>      },<tr><td><a id="l62"></a><a href="#l62">62</a><td>      &#39;BigNum.mod params.n&#39;);<tr><td><a id="l63"></a><a href="#l63">63</a><td>  e2e.testing.Util.addBenchmark(tests,<tr><td><a id="l64"></a><a href="#l64">64</a><td>      function() {<tr><td><a id="l65"></a><a href="#l65">65</a><td>        for (var i = 0; i &lt; TIMES; ++i)<tr><td><a id="l66"></a><a href="#l66">66</a><td>          params.curve.q.residue(P512);<tr><td><a id="l67"></a><a href="#l67">67</a><td>      },<tr><td><a id="l68"></a><a href="#l68">68</a><td>      &#39;FastModulus.NIST.P_256.residue&#39;);<tr><td><a id="l69"></a><a href="#l69">69</a><td>  e2e.testing.Util.addBenchmark(tests,<tr><td><a id="l70"></a><a href="#l70">70</a><td>      function() {<tr><td><a id="l71"></a><a href="#l71">71</a><td>        for (var i = 0; i &lt; TIMES; ++i)<tr><td><a id="l72"></a><a href="#l72">72</a><td>          P512.mod(params.curve.q);<tr><td><a id="l73"></a><a href="#l73">73</a><td>      },<tr><td><a id="l74"></a><a href="#l74">74</a><td>      &#39;BigNum.mod params.curve.q&#39;);<tr><td><a id="l75"></a><a href="#l75">75</a><td>  e2e.testing.Util.addBenchmark(tests,<tr><td><a id="l76"></a><a href="#l76">76</a><td>      function() {<tr><td><a id="l77"></a><a href="#l77">77</a><td>        for (var i = 0; i &lt; TIMES; ++i)<tr><td><a id="l78"></a><a href="#l78">78</a><td>          params.curve.q.modMultiply(A, B);<tr><td><a id="l79"></a><a href="#l79">79</a><td>      },<tr><td><a id="l80"></a><a href="#l80">80</a><td>      &#39;modMultiply with residue&#39;);<tr><td><a id="l81"></a><a href="#l81">81</a><td>  e2e.testing.Util.addBenchmark(tests,<tr><td><a id="l82"></a><a href="#l82">82</a><td>      function() {<tr><td><a id="l83"></a><a href="#l83">83</a><td>        for (var i = 0; i &lt; TIMES; ++i)<tr><td><a id="l84"></a><a href="#l84">84</a><td>          params.curve.q.modMul_(A, B);<tr><td><a id="l85"></a><a href="#l85">85</a><td>      },<tr><td><a id="l86"></a><a href="#l86">86</a><td>      &#39;modMultiply with Montgomery&#39;);<tr><td><a id="l87"></a><a href="#l87">87</a><td><tr><td><a id="l88"></a><a href="#l88">88</a><td>  return e2e.testing.Util.runPerfTests(tests, 10, 10000);<tr><td><a id="l89"></a><a href="#l89">89</a><td>};<tr><td><a id="l90"></a><a href="#l90">90</a><td><tr><td><a id="l91"></a><a href="#l91">91</a><td><tr><td><a id="l92"></a><a href="#l92">92</a><td>/**<tr><td><a id="l93"></a><a href="#l93">93</a><td> * Runs benchmark based on calculations done during RSA encryption/decryption.<tr><td><a id="l94"></a><a href="#l94">94</a><td> * @return {!Object.&lt;string,Object&gt;} Performance stats (object is filled only<tr><td><a id="l95"></a><a href="#l95">95</a><td> *     when tests are run outside browser).<tr><td><a id="l96"></a><a href="#l96">96</a><td> */<tr><td><a id="l97"></a><a href="#l97">97</a><td>e2e.BigNumTester.runRsaBenchmark = function() {<tr><td><a id="l98"></a><a href="#l98">98</a><td>  var tests = [];<tr><td><a id="l99"></a><a href="#l99">99</a><td>  var R = e2e.BigNum.fromInternalArray([9552989, 1615003, 14809368, 4904522,<tr><td><a id="l100"></a><a href="#l100">100</a><td>    7355076, 4187269, 1863597, 12742352, 11743680, 8995794, 3390769, 386177,<tr><td><a id="l101"></a><a href="#l101">101</a><td>    6204949, 4941333, 2320445, 10095948, 10877138, 15687067, 3915499,<tr><td><a id="l102"></a><a href="#l102">102</a><td>    11722178, 8689194, 6489401, 3545525, 11005113, 14506245, 2747106, 2327502,<tr><td><a id="l103"></a><a href="#l103">103</a><td>    13294668, 796929, 12338512, 16422056, 13415665, 20936, 7503485, 10120731,<tr><td><a id="l104"></a><a href="#l104">104</a><td>    4398963, 11027881, 8867546, 9604175, 16130473, 10495524, 5458067, 4373902,<tr><td><a id="l105"></a><a href="#l105">105</a><td>    12435907, 2000823, 12395738, 14597390, 14618885, 3388439, 13809253,<tr><td><a id="l106"></a><a href="#l106">106</a><td>    622223, 9776305, 1459633, 5453684, 3386586, 15743276, 9941491, 3981193,<tr><td><a id="l107"></a><a href="#l107">107</a><td>    4599910, 8965174, 1361517, 516697, 10243977, 4276994, 1283371, 7283820,<tr><td><a id="l108"></a><a href="#l108">108</a><td>    14866805, 14699256, 2419248, 15123242, 10212919, 20327, 4200618, 764560,<tr><td><a id="l109"></a><a href="#l109">109</a><td>    12740931, 6512547, 15318902, 4592605, 5494814, 5018039, 5027471, 9401018,<tr><td><a id="l110"></a><a href="#l110">110</a><td>    10065598, 6430665, 5671941, 55]);<tr><td><a id="l111"></a><a href="#l111">111</a><td>  var P = e2e.BigNum.fromInternalArray([6753405, 5769422, 10224689, 15976806,<tr><td><a id="l112"></a><a href="#l112">112</a><td>    8758122, 1072390, 4295632, 15680865, 717154, 13687529, 1112642, 8210487,<tr><td><a id="l113"></a><a href="#l113">113</a><td>    8674065, 16472383, 4958898, 4514561, 4926786, 12952480, 2197481, 15503687,<tr><td><a id="l114"></a><a href="#l114">114</a><td>    10446902, 15006300, 6566859, 10621344, 4856330, 3611029, 4575303, 5114846,<tr><td><a id="l115"></a><a href="#l115">115</a><td>    10739212, 77949, 1368804, 15633764, 3877290, 2647557, 7397065, 2541923,<tr><td><a id="l116"></a><a href="#l116">116</a><td>    15815710, 9372307, 10405740, 1046137, 8854227, 16407473, 55686]);<tr><td><a id="l117"></a><a href="#l117">117</a><td>  var Q = e2e.BigNum.fromInternalArray([14383571, 2725147, 1528216, 12249209,<tr><td><a id="l118"></a><a href="#l118">118</a><td>    13685854, 15618693, 14077205, 15428400, 7554178, 9206633, 2299721,<tr><td><a id="l119"></a><a href="#l119">119</a><td>    5321660, 10331996, 12455867, 4483294, 15788877, 2961165, 14617551,<tr><td><a id="l120"></a><a href="#l120">120</a><td>    14311372, 11919960, 15077011, 6090064, 7398736, 321109, 1846502, 12589864,<tr><td><a id="l121"></a><a href="#l121">121</a><td>    10866071, 13127796, 6485731, 7546899, 6106326, 8535434, 792407, 13139406,<tr><td><a id="l122"></a><a href="#l122">122</a><td>    1739551, 16321367, 11339242, 11852623, 2171797, 13046071, 15446997,<tr><td><a id="l123"></a><a href="#l123">123</a><td>    13999581, 55773]);<tr><td><a id="l124"></a><a href="#l124">124</a><td>  var E = [1, 0, 1];<tr><td><a id="l125"></a><a href="#l125">125</a><td>  var D = e2e.BigNum.fromInternalArray([10820729, 13747050, 15959517, 6818106,<tr><td><a id="l126"></a><a href="#l126">126</a><td>    5862037, 16671897, 5810502, 15842160, 3222923, 3805120, 13279531, 11699960,<tr><td><a id="l127"></a><a href="#l127">127</a><td>    10351352, 9363391, 7867926, 6120986, 3617501, 7650412, 10463268, 16251881,<tr><td><a id="l128"></a><a href="#l128">128</a><td>    7553626, 9240544, 7031557, 13225877, 4748514, 11304774, 8934319, 16167591,<tr><td><a id="l129"></a><a href="#l129">129</a><td>    4492085, 7685100, 15517835, 8532384, 2072218, 442140, 10906376, 14554942,<tr><td><a id="l130"></a><a href="#l130">130</a><td>    13278383, 3961273, 15929224, 10072494, 14940569, 11319601, 2236198, 8891069,<tr><td><a id="l131"></a><a href="#l131">131</a><td>    3827008, 3719443, 1558550, 15342967, 7016511, 15582499, 9490273, 2197899,<tr><td><a id="l132"></a><a href="#l132">132</a><td>    16594504, 16115018, 1041998, 16031226, 1484094, 12406232, 11208427, 1336816,<tr><td><a id="l133"></a><a href="#l133">133</a><td>    12652050, 4451854, 424909, 424791, 2528324, 14293940, 88835, 647903,<tr><td><a id="l134"></a><a href="#l134">134</a><td>    10368581, 551217, 8695177, 12461502, 3202524, 13840070, 2301754, 4007734,<tr><td><a id="l135"></a><a href="#l135">135</a><td>    486777, 2944759, 16742009, 5112427, 5231125, 6843874, 1646722, 1597755,<tr><td><a id="l136"></a><a href="#l136">136</a><td>    15416815, 23]);<tr><td><a id="l137"></a><a href="#l137">137</a><td>  var PLAINTEXT = [2, 245, 43, 251, 48, 144, 215, 33, 150, 127, 77, 174, 246,<tr><td><a id="l138"></a><a href="#l138">138</a><td>    202, 113, 144, 111, 34, 18, 129, 95, 33, 10, 240, 199, 80, 71, 158, 65,<tr><td><a id="l139"></a><a href="#l139">139</a><td>    48, 180, 48, 228, 193, 224, 214, 158, 185, 64, 181, 50, 17, 173, 184, 217,<tr><td><a id="l140"></a><a href="#l140">140</a><td>    207, 217, 69, 5, 133, 183, 161, 158, 210, 83, 90, 106, 9, 98, 3, 102, 213,<tr><td><a id="l141"></a><a href="#l141">141</a><td>    28, 227, 58, 126, 47, 90, 154, 35, 214, 232, 227, 78, 136, 248, 223, 195,<tr><td><a id="l142"></a><a href="#l142">142</a><td>    36, 86, 74, 96, 161, 104, 33, 132, 48, 104, 119, 171, 51, 143, 95, 186,<tr><td><a id="l143"></a><a href="#l143">143</a><td>    102, 229, 67, 160, 114, 139, 237, 170, 65, 173, 80, 34, 150, 47, 28, 59,<tr><td><a id="l144"></a><a href="#l144">144</a><td>    96, 51, 117, 110, 40, 213, 192, 29, 54, 201, 177, 39, 35, 164, 35, 255,<tr><td><a id="l145"></a><a href="#l145">145</a><td>    101, 116, 196, 206, 43, 181, 92, 186, 185, 254, 100, 10, 29, 83, 19, 188,<tr><td><a id="l146"></a><a href="#l146">146</a><td>    217, 17, 47, 200, 194, 70, 38, 203, 50, 114, 176, 51, 81, 139, 94, 181,<tr><td><a id="l147"></a><a href="#l147">147</a><td>    213, 191, 11, 223, 221, 126, 93, 171, 208, 157, 93, 85, 77, 222, 106, 71,<tr><td><a id="l148"></a><a href="#l148">148</a><td>    82, 45, 119, 187, 138, 202, 95, 186, 218, 135, 158, 242, 182, 60, 226,<tr><td><a id="l149"></a><a href="#l149">149</a><td>    105, 242, 144, 235, 169, 112, 221, 23, 70, 49, 66, 80, 85, 202, 192, 170,<tr><td><a id="l150"></a><a href="#l150">150</a><td>    163, 116, 220, 213, 22, 164, 92, 20, 104, 250, 113, 41, 63, 47, 0, 9, 19,<tr><td><a id="l151"></a><a href="#l151">151</a><td>    169, 192, 3, 120, 200, 6, 69, 115, 124, 101, 174, 131, 50, 36, 213, 5,<tr><td><a id="l152"></a><a href="#l152">152</a><td>    109, 207, 119, 21, 94, 210, 82, 148, 25, 61, 220, 144, 181, 138, 49, 13,<tr><td><a id="l153"></a><a href="#l153">153</a><td>    207];<tr><td><a id="l154"></a><a href="#l154">154</a><td>  e2e.testing.Util.addBenchmark(tests,<tr><td><a id="l155"></a><a href="#l155">155</a><td>      function() {<tr><td><a id="l156"></a><a href="#l156">156</a><td>        var modulus = e2e.BigNumModulus.fromBigNum(P.multiply(Q));<tr><td><a id="l157"></a><a href="#l157">157</a><td>        // Blinding calculations<tr><td><a id="l158"></a><a href="#l158">158</a><td>        var phi = modulus.add(e2e.BigNum.ONE).subtract(P.add(Q));<tr><td><a id="l159"></a><a href="#l159">159</a><td>        var inv = modulus.modPower(R, phi.subtract(e2e.BigNum.ONE));<tr><td><a id="l160"></a><a href="#l160">160</a><td>        var blinder = modulus.modPower(inv, E);<tr><td><a id="l161"></a><a href="#l161">161</a><td>        var unblinder = R;<tr><td><a id="l162"></a><a href="#l162">162</a><td>        // Encryption<tr><td><a id="l163"></a><a href="#l163">163</a><td>        var c = modulus.pow(PLAINTEXT, E);<tr><td><a id="l164"></a><a href="#l164">164</a><td>        // Decryption<tr><td><a id="l165"></a><a href="#l165">165</a><td>        var blinded = modulus.modMultiply(new e2e.BigNum(c), blinder);<tr><td><a id="l166"></a><a href="#l166">166</a><td>        var decryption = modulus.modPower(blinded, D);<tr><td><a id="l167"></a><a href="#l167">167</a><td>        var plaintext = modulus.modMultiply(decryption, unblinder);<tr><td><a id="l168"></a><a href="#l168">168</a><td>      },<tr><td><a id="l169"></a><a href="#l169">169</a><td>      &#39;RSA encryption &amp; decryption&#39;);<tr><td><a id="l170"></a><a href="#l170">170</a><td>  return e2e.testing.Util.runPerfTests(tests, 10, 40000);<tr><td><a id="l171"></a><a href="#l171">171</a><td>};</table></div></article><nav><h3><a href="../../../../../../index.html">Overview</a></h3><div><input type="checkbox" id="nav-types" checked/><label for="nav-types"><h3><span class="selectable">Types</span></h3></label><div id="nav-types-view"></div></div></nav></main><div class="pre-footer"><div></div></div><footer><div><a href="https://github.com/jleyba/js-dossier">Generated by dossier</a></div></footer><script src="../../../../../../types.js"></script><script src="../../../../../../dossier.js"></script>